# 用户认证 API

## 1. 用户登录

### 接口信息

- **路径**: `/api/auth/login`
- **方法**: `POST`
- **认证**: 不需要
- **描述**: 用户登录获取 JWT Token

### 请求参数

```json
{
  "username": "user123",
  "password": "secure_password"
}
```

### 响应示例

```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "refresh_token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "user": {
    "id": "uuid-string",
    "username": "user123",
    "role": "user"
  }
}
```

### Token 说明

- **access_token**: 访问令牌，有效期 1 小时
- **refresh_token**: 刷新令牌，有效期 7 天

### 状态码

- `200` - 登录成功
- `401` - 用户名或密码错误

---

## 2. 刷新 Token

### 接口信息

- **路径**: `/api/auth/refresh`
- **方法**: `POST`
- **认证**: 不需要
- **描述**: 使用 refresh_token 获取新的 access_token

### 请求参数

```json
{
  "refresh_token": "eyJ0eXAiOiJKV1QiLCJhbGc..."
}
```

### 响应示例

```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGc..."
}
```

### 状态码

- `200` - 刷新成功
- `400` - refresh_token 无效

---

## 3. 获取当前用户信息

### 接口信息

- **路径**: `/api/auth/me`
- **方法**: `GET`
- **认证**: 需要
- **描述**: 获取当前登录用户信息

### 请求头

```
Authorization: Bearer <access_token>
```

### 响应示例

```json
{
  "id": "uuid-string",
  "username": "user123",
  "email": "user@example.com",
  "role": "user",
  "created_at": "2024-01-01T00:00:00Z"
}
```

### 状态码

- `200` - 成功
- `401` - 未认证

---

## 4. 修改密码

### 接口信息

- **路径**: `/api/auth/password`
- **方法**: `PUT`
- **认证**: 需要
- **描述**: 修改当前用户密码

### 请求参数

```json
{
  "old_password": "old_password",
  "new_password": "new_password"
}
```

### 响应示例

```json
{
  "message": "密码修改成功"
}
```

### 状态码

- `200` - 修改成功
- `400` - 旧密码错误
- `401` - 未认证

---

## 5. 用户注册

### 接口信息

- **路径**: `/api/users/register/`
- **方法**: `POST`
- **认证**: 不需要
- **描述**: 注册新用户（需要系统开放注册）

### 请求参数

```json
{
  "username": "newuser",
  "password": "secure_password",
  "email": "user@example.com"
}
```

### 请求字段

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| username | string | 是 | 用户名 |
| password | string | 是 | 密码 |
| email | string | 否 | 邮箱 |

### 响应示例

```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "refresh_token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "user": {
    "id": "uuid-string",
    "username": "newuser"
  }
}
```

### 状态码

- `201` - 注册成功
- `400` - 参数错误
- `403` - 注册未开放

### 注意事项

- 系统管理员在初始化时可以设置是否允许注册
- 如果 `allow_register` 为 false，此接口返回 403
- 注册成功后自动返回 JWT token

---

## 6. 用户资产汇总

### 接口信息

- **路径**: `/api/users/me/summary/`
- **方法**: `GET`
- **认证**: 需要
- **描述**: 获取当前用户的资产汇总信息

### 请求头

```
Authorization: Bearer <access_token>
```

### 响应示例

```json
{
  "account_count": 3,
  "position_count": 10,
  "total_cost": "123456.78",
  "total_value": "135678.90",
  "total_pnl": "12222.12"
}
```

### 响应字段

| 字段 | 类型 | 说明 |
|------|------|------|
| account_count | integer | 账户数量 |
| position_count | integer | 持仓数量 |
| total_cost | decimal | 总成本 |
| total_value | decimal | 总市值（基于昨日净值） |
| total_pnl | decimal | 总盈亏 |

### 状态码

- `200` - 成功
- `401` - 未认证
